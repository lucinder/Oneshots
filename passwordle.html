<!DOCTYPE HTML>
<html>
<head>
    <title>Passwordle</title>
    <style>
        body{
            max-width: 80%;
            margin:auto;
            margin-top: 50px;
            font-family: Arial, Helvetica, sans-serif;
        }
        p{
            color:darkslategray;
            display:flex;
        }
    </style>
    <script type="text/javascript">
        const maxGuess = 10;
        const char_correct = 'ðŸŸ©';
        const char_wrongposition = 'ðŸŸ¨';
        const char_incorrect = 'â¬œ';
        const DEBUG = true; // debug flag
        var items, password, guessesRemaining;
    </script>
</head>
<body>
    <h1>Passwordle</h1>
    <p>Passwordle is a Wordle-like game where you guess a password, randomly chosen from a selection of the rockyou.txt file which contains many common passwords used in brute-force attacks by hackers and penetration testers. The password may be any length. A green character (ðŸŸ©) indicates a correct character in the correct position. A yellow character (ðŸŸ¨) indicates a character in the word, at a different position. Finally, a blank character (â¬œ) indicates a letter that is not in the word.</p>
    <p>Please be wary that these passwords may contain offensive, explicit, or sexual language and slurs; play at your own discretion!</p>
     <div class="game">
        <div id="guesses">
        </div>
        <br>
        <input type="text" id="input" placeholder="Password">
        <br>
        <input type="Submit" value="Guess Password" id="submit">
    </div>
    <script type="text/javascript">
        async function loadPasswords(){
            await fetch("rockyou.txt")
            .then(response => response.text())
            .then(text => {
                items = text.split("\n");
                console.log("Passwords loaded successfully!");
                getNewPassword(); // Call this ONLY after loading completes
            })
            .catch(error => console.error("Failed to load file:", error));
        }
        function getNewPassword(){
            guessesRemaining = maxGuess;
            if(DEBUG) console.log("[DEBUG] There are " + items.length + " possible passwords.");
            selection=Math.floor(Math.random()*items.length);
            if(DEBUG) console.log("[DEBUG] The password index is " + selection);
            password=items[selection];
            if(DEBUG) console.log("[DEBUG] The password is " + password);
        }
        window.addEventListener("load", (event) => {
            loadPasswords();
        });
        function guessPassword(input){
            let output = ""
            for (let i = 0; i < input.length; i++){
                let currentChar = input[i];
                if (i < password.length){
                    if (currentChar == password[i]){
                        output += char_correct;
                    } else if (password.includes(currentChar)){
                        output += char_wrongposition;
                    } else {
                        output += char_incorrect;
                    }
                }
            }
            if (i < password.length){ // characters leftover in password
                for (; i < password.length; i++){
                    output += char_incorrect;
                }
            }
            if(DEBUG) console.log("[DEBUG] Guess characters: " + output);
            return output;
        }

        document.getElementById("submit").addEventListener("click", parseSubmit);

        function parseSubmit(){
            let input = document.getElementById("input").value;
            if(!input.length == 0){
                let echo = document.createElement("p");
                let output_block = document.createElement("p");
                echo.value = "You guessed: " + input;
                let output = guessPassword(input);
                output_block.value = output;
                guesses = document.getElementById("guesses");
                guesses.append(echo);
                guess.append(output_block);
                guessesRemaining -= 1;
            }
        }
    </script>
</body>
</html>